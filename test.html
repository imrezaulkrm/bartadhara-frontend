<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Total News Section -->
        <div>
            <h3>Total News: <span id="total-news">Loading...</span></h3>
        </div>

        <!-- Total Users Section -->
        <div>
            <h3>Total Users: <span id="total-users">Loading...</span></h3>
        </div>

        <!-- Total Admins Section -->
        <div>
            <h3>Total Admins: <span id="total-admins">Loading...</span></h3>
        </div>

        <!-- News by Category Chart -->
        <canvas id="news-chart"></canvas>
    </div>

    <script>
        async function fetchData() {
            try {
                // Fetch total news count
                const newsResponse = await fetch('http://localhost:8080/news'); // This will call your backend API for news
                const newsData = await newsResponse.json();
                document.getElementById('total-news').textContent = newsData.length;

                // Fetch total users count
                const usersResponse = await fetch('http://localhost:8080/users'); // This will call your backend API for users
                const usersData = await usersResponse.json();
                document.getElementById('total-users').textContent = usersData.length;

                // Fetch total admins count
                const adminsResponse = await fetch('http://localhost:8080/admin'); // This will call your backend API for admins
                const adminsData = await adminsResponse.json();
                document.getElementById('total-admins').textContent = adminsData.length;

                // News by Category
                const categoryResponse = await fetch('http://localhost:8080/news'); // Same API to get the news data
                const categoryData = await categoryResponse.json();

                // Prepare data for the chart
                const categories = categoryData.map(news => news.category);
                const categoryCounts = categories.reduce((acc, category) => {
                    acc[category] = (acc[category] || 0) + 1;
                    return acc;
                }, {});

                const chartLabels = Object.keys(categoryCounts);
                const chartData = Object.values(categoryCounts);

                // Create chart
                const ctx = document.getElementById('news-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            label: 'News by Category',
                            data: chartData,
                            backgroundColor: '#FF5733',
                            borderColor: '#FF5733',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });

            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Call the function on page load
        fetchData();
    </script>
</body>
</html>
